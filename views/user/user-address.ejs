<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Labelle — Address Book</title>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=Jost:wght@300;400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --cream: #f9f4ee;
      --warm-white: #fdf9f5;
      --gold: #c9a96e;
      --gold-light: #e8d5b0;
      --dark: #1a1410;
      --muted: #8a7968;
      --border: rgba(201,169,110,0.25);
      --panel-bg: #fff8f2;
    }

    html { scroll-behavior: smooth; }

    body {
      font-family: 'Jost', sans-serif;
      background: var(--warm-white);
      color: var(--dark);
      overflow-x: hidden;
      min-height: 100vh;
    }

    /* ── NAVBAR ── */
    nav {
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 5vw;
      height: 72px;
      background: rgba(253,249,245,0.92);
      backdrop-filter: blur(14px);
      border-bottom: 1px solid var(--border);
    }
    .nav-logo {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.7rem;
      font-weight: 600;
      letter-spacing: 0.12em;
      color: var(--dark);
      text-decoration: none;
    }
    .nav-logo span { color: var(--gold); }
    .nav-links { display: flex; gap: 2.4rem; list-style: none; }
    .nav-links a {
      text-decoration: none;
      font-size: 0.78rem;
      font-weight: 400;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--muted);
      transition: color 0.2s;
    }
    .nav-links a:hover { color: var(--gold); }
    .nav-actions { display: flex; align-items: center; gap: 1.4rem; }
    .nav-actions a {
      text-decoration: none;
      font-size: 0.75rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--muted);
      transition: color 0.2s;
    }
    .nav-actions a:hover { color: var(--dark); }

    /* ── PAGE ── */
    .page-wrapper { padding-top: 72px; min-height: 100vh; }

    .page-banner {
      background: linear-gradient(135deg, #1a1410 0%, #2e1f10 40%, #4a2e18 70%, #1a1410 100%);
      padding: 3.5rem 5vw 3rem;
      position: relative;
      overflow: hidden;
    }
    .page-banner::before {
      content: '';
      position: absolute;
      top: -60%; right: -5%;
      width: 50vw; height: 50vw;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(201,169,110,0.15) 0%, transparent 65%);
      pointer-events: none;
    }
    .banner-inner { position: relative; z-index: 1; }
    .banner-eyebrow {
      font-size: 0.68rem;
      letter-spacing: 0.3em;
      text-transform: uppercase;
      color: var(--gold);
      margin-bottom: 0.6rem;
    }
    .banner-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: clamp(2rem, 4vw, 3rem);
      font-weight: 300;
      color: var(--cream);
      line-height: 1.1;
    }
    .banner-title em { font-style: italic; color: var(--gold-light); }

    /* ── LAYOUT ── */
    .profile-layout {
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 2rem;
      padding: 2.5rem 5vw 4rem;
      max-width: 1200px;
      margin: 0 auto;
      align-items: start;
    }

    /* ── SIDEBAR ── */
    .sidebar {
      position: sticky;
      top: 90px;
      animation: fadeUp 0.8s cubic-bezier(0.22,1,0.36,1) both;
    }
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(24px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    .sidebar-card { background: var(--panel-bg); border: 1px solid var(--border); overflow: hidden; }
    .sidebar-avatar-area {
      background: linear-gradient(145deg, #1a1410, #2e1f10);
      padding: 2.2rem 1.5rem 1.8rem;
      text-align: center;
      position: relative;
    }
    .sidebar-avatar-area::after {
      content: '';
      position: absolute;
      bottom: -1px; left: 0; right: 0;
      height: 2px;
      background: linear-gradient(to right, transparent, var(--gold), transparent);
    }
    .avatar-ring {
      width: 96px; height: 96px;
      border-radius: 50%;
      border: 2px solid var(--gold);
      padding: 3px;
      display: inline-block;
      margin-bottom: 1rem;
    }
    .avatar-ring img {
      width: 100%; height: 100%;
      border-radius: 50%;
      object-fit: cover;
      display: block;
    }
    .sidebar-name {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.3rem;
      font-weight: 400;
      color: var(--cream);
      margin-bottom: 0.25rem;
    }
    .sidebar-email {
      font-size: 0.72rem;
      color: rgba(249,244,238,0.45);
      letter-spacing: 0.04em;
      word-break: break-all;
    }
    .sidebar-email a { color: inherit; text-decoration: none; }
    .sidebar-nav { list-style: none; padding: 0.5rem 0; }
    .sidebar-nav li { border-bottom: 1px solid var(--border); }
    .sidebar-nav li:last-child { border-bottom: none; }
    .sidebar-nav a {
      display: flex;
      align-items: center;
      gap: 0.9rem;
      padding: 0.85rem 1.4rem;
      text-decoration: none;
      font-size: 0.78rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--muted);
      transition: background 0.2s, color 0.2s;
      border-left: 3px solid transparent;
    }
    .sidebar-nav a:hover {
      background: rgba(201,169,110,0.06);
      color: var(--dark);
      border-left-color: var(--gold);
    }
    .sidebar-nav li.active a {
      background: rgba(201,169,110,0.08);
      color: var(--dark);
      border-left-color: var(--gold);
    }
    .sidebar-nav i { font-size: 0.85rem; color: var(--gold); width: 16px; text-align: center; }

    /* ── MAIN CONTENT ── */
    .main-content {
      display: flex;
      flex-direction: column;
      gap: 1.8rem;
      animation: fadeUp 0.8s 0.12s cubic-bezier(0.22,1,0.36,1) both;
    }
    .content-panel { background: var(--panel-bg); border: 1px solid var(--border); overflow: hidden; }
    .panel-header {
      padding: 1.4rem 2rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      flex-wrap: wrap;
    }
    .panel-eyebrow {
      font-size: 0.65rem;
      letter-spacing: 0.25em;
      text-transform: uppercase;
      color: var(--gold);
      margin-bottom: 0.2rem;
    }
    .panel-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.5rem;
      font-weight: 300;
      color: var(--dark);
    }

    /* ── ADDRESS GRID ── */
    .address-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1.4rem;
      padding: 2rem;
    }

    .address-card {
      border: 1px solid var(--border);
      background: var(--warm-white);
      position: relative;
      transition: box-shadow 0.3s, transform 0.3s;
      overflow: hidden;
    }
    .address-card:hover {
      box-shadow: 0 12px 40px rgba(26,20,16,0.1);
      transform: translateY(-3px);
    }
    .address-card::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 3px;
      background: linear-gradient(to right, var(--gold), var(--gold-light));
      opacity: 0;
      transition: opacity 0.3s;
    }
    .address-card:hover::before { opacity: 1; }

    .address-card-inner { padding: 1.4rem; }

    .address-type-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.3rem 0.8rem;
      background: rgba(201,169,110,0.12);
      border: 1px solid var(--border);
      font-size: 0.65rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--gold);
      margin-bottom: 1rem;
    }

    .address-name {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.1rem;
      font-weight: 400;
      color: var(--dark);
      margin-bottom: 0.5rem;
    }

    .address-text {
      font-size: 0.8rem;
      color: var(--muted);
      line-height: 1.7;
      font-weight: 300;
    }

    .address-card-footer {
      display: flex;
      justify-content: flex-end;
      gap: 0.6rem;
      padding: 0.8rem 1.4rem;
      border-top: 1px solid var(--border);
      background: rgba(249,244,238,0.5);
    }

    .icon-btn {
      width: 34px; height: 34px;
      display: flex; align-items: center; justify-content: center;
      border: 1px solid var(--border);
      background: transparent;
      cursor: pointer;
      transition: background 0.2s, border-color 0.2s;
      color: var(--muted);
      font-size: 0.8rem;
    }
    .icon-btn.edit:hover { background: rgba(201,169,110,0.15); border-color: var(--gold); color: var(--gold); }
    .icon-btn.delete:hover { background: rgba(192,57,43,0.08); border-color: #c0392b; color: #c0392b; }

    /* ── ADD ADDRESS BUTTON ── */
    .add-address-card {
      border: 1px dashed rgba(201,169,110,0.4);
      background: transparent;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.8rem;
      padding: 2rem;
      cursor: pointer;
      transition: background 0.2s, border-color 0.2s;
      min-height: 160px;
      text-align: center;
    }
    .add-address-card:hover {
      background: rgba(201,169,110,0.05);
      border-color: var(--gold);
    }
    .add-icon {
      width: 44px; height: 44px;
      border: 1px solid var(--border);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      color: var(--gold);
      font-size: 1rem;
      transition: background 0.2s;
    }
    .add-address-card:hover .add-icon { background: rgba(201,169,110,0.12); }
    .add-label {
      font-size: 0.75rem;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--muted);
    }

    /* ── GOLD DIVIDER ── */
    .gold-divider {
      height: 1px;
      background: linear-gradient(to right, transparent, var(--gold), transparent);
    }

    /* ── MODAL ── */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      z-index: 200;
      background: rgba(26,20,16,0.6);
      backdrop-filter: blur(4px);
      align-items: center;
      justify-content: center;
    }
    .modal-overlay.open { display: flex; }

    .modal-box {
      background: var(--warm-white);
      border: 1px solid var(--border);
      width: 100%;
      max-width: 520px;
      max-height: 90vh;
      overflow-y: auto;
      animation: fadeUp 0.35s cubic-bezier(0.22,1,0.36,1) both;
    }

    .modal-head {
      padding: 1.4rem 2rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .modal-head-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.4rem;
      font-weight: 300;
      color: var(--dark);
    }
    .modal-close {
      background: none;
      border: none;
      cursor: pointer;
      color: var(--muted);
      font-size: 1rem;
      padding: 0.25rem 0.5rem;
      transition: color 0.2s;
    }
    .modal-close:hover { color: var(--dark); }

    .modal-body-inner { padding: 2rem; }

    .modal-form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.2rem 1.4rem;
    }
    .modal-form-group { display: flex; flex-direction: column; gap: 0.4rem; }
    .modal-form-group.full { grid-column: 1 / -1; }

    .modal-label {
      font-size: 0.66rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--muted);
    }
    .modal-input,
    .modal-select {
      padding: 0.7rem 1rem;
      background: var(--panel-bg);
      border: 1px solid var(--border);
      color: var(--dark);
      font-family: 'Jost', sans-serif;
      font-size: 0.85rem;
      font-weight: 300;
      outline: none;
      transition: border-color 0.2s;
      appearance: none;
      -webkit-appearance: none;
    }
    .modal-input:focus, .modal-select:focus { border-color: var(--gold); }
    .modal-input::placeholder { color: rgba(138,121,104,0.5); }

    .select-wrap { position: relative; }
    .select-wrap::after {
      content: '▾';
      position: absolute;
      right: 1rem; top: 50%;
      transform: translateY(-50%);
      color: var(--gold);
      pointer-events: none;
      font-size: 0.8rem;
    }

    .field-err {
      font-size: 0.7rem;
      color: #c0392b;
      margin-top: 0.15rem;
      display: none;
    }

    .modal-footer-inner {
      padding: 1.2rem 2rem;
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: flex-end;
      gap: 0.8rem;
      background: rgba(249,244,238,0.4);
    }

    .btn-gold {
      padding: 0.7rem 1.8rem;
      background: var(--gold);
      color: var(--dark);
      border: none;
      font-family: 'Jost', sans-serif;
      font-size: 0.75rem;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s, transform 0.2s;
    }
    .btn-gold:hover { background: var(--gold-light); transform: translateY(-1px); }

    .btn-outline-dark {
      padding: 0.7rem 1.8rem;
      background: transparent;
      color: var(--dark);
      border: 1px solid rgba(26,20,16,0.25);
      font-family: 'Jost', sans-serif;
      font-size: 0.75rem;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      font-weight: 400;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
    }
    .btn-outline-dark:hover { background: var(--dark); color: var(--cream); }

    /* empty state */
    .empty-state {
      text-align: center;
      padding: 3rem 2rem;
      color: var(--muted);
    }
    .empty-state i { font-size: 2.5rem; color: var(--gold); margin-bottom: 1rem; opacity: 0.5; }
    .empty-state p { font-size: 0.88rem; font-weight: 300; }

    /* ── RESPONSIVE ── */
    @media (max-width: 900px) {
      .profile-layout { grid-template-columns: 1fr; }
      .sidebar { position: static; }
    }
    @media (max-width: 600px) {
      .nav-links { display: none; }
      .modal-form-grid { grid-template-columns: 1fr; }
      .modal-form-group.full { grid-column: 1; }
    }
  </style>
</head>
<body>

<!-- ── NAVBAR ── -->
<nav>
  <a href="/" class="nav-logo">La<span>belle</span></a>
  <ul class="nav-links">
    <li><a href="/">Home</a></li>
    <li><a href="/shop">Shop</a></li>
    <li><a href="#">Contact</a></li>
  </ul>
  <div class="nav-actions">
    <% if (typeof user !== 'undefined' && user) { %>
      <a href="#">Favourites</a>
      <a href="/user-profile">Profile</a>
    <% } else { %>
      <a href="/login">Login</a>
    <% } %>
  </div>
</nav>

<div class="page-wrapper">

  <!-- ── BANNER ── -->
  <div class="page-banner">
    <div class="banner-inner">
      <p class="banner-eyebrow">Account</p>
      <h1 class="banner-title">Address <em>Book</em></h1>
    </div>
  </div>

  <!-- ── LAYOUT ── -->
  <div class="profile-layout">

    <!-- ── SIDEBAR ── -->
    <aside class="sidebar">
      <div class="sidebar-card">
        <div class="sidebar-avatar-area">
          <div class="avatar-ring">
            <img src="<%= userData.gender === 'male'
              ? 'https://www.bootdey.com/img/Content/avatar/avatar2.png'
              : userData.gender === 'female'
              ? 'https://www.bootdey.com/img/Content/avatar/avatar3.png'
              : 'https://via.placeholder.com/150' %>"
              alt="User Avatar">
          </div>
          <div class="sidebar-name"><%= userData ? userData.name : 'Guest' %></div>
          <div class="sidebar-email">
            <a href="mailto:<%= userData ? userData.email : '' %>">
              <%= userData ? userData.email : 'Email not available' %>
            </a>
          </div>
        </div>
        <ul class="sidebar-nav">
          <li id="profile"><a href="/user-profile"><i class="fa fa-user"></i> Profile</a></li>
          <li id="address-book"><a href="/user-address"><i class="fa fa-location-dot"></i> Address Book</a></li>
          <li id="order-details"><a href="/user-order"><i class="fa fa-bag-shopping"></i> Order Details</a></li>
          <li id="coupon"><a href="/user-coupon"><i class="fa fa-tag"></i> Coupons</a></li>
          <li id="wallet"><a href="/user-wallet"><i class="fa fa-wallet"></i> Wallet</a></li>
          <% if (typeof user !== 'undefined' && user) { %>
          <li id="logout"><a href="/logout"><i class="fa fa-right-from-bracket"></i> Logout</a></li>
          <% } %>
        </ul>
      </div>
    </aside>

    <!-- ── MAIN ── -->
    <main class="main-content">
      <div class="content-panel">
        <div class="panel-header">
          <div>
            <p class="panel-eyebrow">Delivery Locations</p>
            <h2 class="panel-title">Manage Addresses</h2>
          </div>
        </div>

        <div class="address-grid">

          <% if (typeof addresses !== 'undefined' && addresses.length > 0) { %>
            <% addresses.forEach(function(address) { %>
            <div class="address-card" id="address-<%= address._id %>">
              <div class="address-card-inner">
                <div class="address-type-badge">
                  <i class="fa fa-<%= address.addressType === 'Home' ? 'house' : address.addressType === 'Work' ? 'briefcase' : 'location-dot' %>"></i>
                  <%= address.addressType %>
                </div>
                <div class="address-name"><%= address.name %></div>
                <div class="address-text">
                  <%= address.streetAddress %>,<br>
                  <% if (address.landmark) { %><%= address.landmark %>,<br><% } %>
                  <%= address.city %>, <%= address.state %> – <%= address.pincode %><br>
                  <i class="fa fa-phone" style="font-size:0.7rem; margin-right:0.3rem;"></i><%= address.phone %>
                </div>
              </div>
              <div class="address-card-footer">
                <button class="icon-btn edit editAddressButton"
                  title="Edit"
                  data-addressid="<%= address._id %>"
                  data-addressType="<%= address.addressType %>"
                  data-name="<%= address.name %>"
                  data-streetAddress="<%= address.streetAddress %>"
                  data-city="<%= address.city %>"
                  data-landmark="<%= address.landmark %>"
                  data-state="<%= address.state %>"
                  data-pincode="<%= address.pincode %>"
                  data-phone="<%= address.phone %>">
                  <i class="fa fa-pen"></i>
                </button>
                <button class="icon-btn delete deleteAddressBtn" title="Delete" data-id="<%= address._id %>">
                  <i class="fa fa-trash"></i>
                </button>
              </div>
            </div>
            <% }); %>
          <% } %>

          <!-- Add new address card -->
          <div class="add-address-card" id="openAddModal">
            <div class="add-icon"><i class="fa fa-plus"></i></div>
            <span class="add-label">Add New Address</span>
          </div>

        </div>
      </div>
    </main>
  </div>
</div>

<!-- ── ADD ADDRESS MODAL ── -->
<div class="modal-overlay" id="addAddressModal">
  <div class="modal-box">
    <div class="modal-head">
      <span class="modal-head-title">Add New Address</span>
      <button class="modal-close" id="closeAddModal"><i class="fa fa-xmark"></i></button>
    </div>
    <div class="modal-body-inner">
      <div class="modal-form-grid">
        <div class="modal-form-group full">
          <label class="modal-label">Address Type</label>
          <div class="select-wrap">
            <select class="modal-select" id="addressType">
              <option value="">Select type</option>
              <option value="Home">Home</option>
              <option value="Work">Work</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <span class="field-err" id="addressTypeError">Please select an address type.</span>
        </div>
        <div class="modal-form-group full">
          <label class="modal-label">Full Name</label>
          <input class="modal-input" type="text" id="name" placeholder="Your name">
          <span class="field-err" id="nameError">Please enter your name.</span>
        </div>
        <div class="modal-form-group full">
          <label class="modal-label">Street Address</label>
          <input class="modal-input" type="text" id="streetAddress" placeholder="House no., street, area">
          <span class="field-err" id="streetAddressError">Please enter your street address.</span>
        </div>
        <div class="modal-form-group">
          <label class="modal-label">City</label>
          <input class="modal-input" type="text" id="city" placeholder="City">
          <span class="field-err" id="cityError">Please enter your city.</span>
        </div>
        <div class="modal-form-group">
          <label class="modal-label">Landmark</label>
          <input class="modal-input" type="text" id="landmark" placeholder="Nearby landmark">
          <span class="field-err" id="landmarkError">Please enter a landmark.</span>
        </div>
        <div class="modal-form-group">
          <label class="modal-label">State</label>
          <input class="modal-input" type="text" id="state" placeholder="State">
          <span class="field-err" id="stateError">Please enter your state.</span>
        </div>
        <div class="modal-form-group">
          <label class="modal-label">Pincode</label>
          <input class="modal-input" type="text" id="pincode" placeholder="6-digit pincode">
          <span class="field-err" id="pincodeError">Please enter a valid 6-digit pincode.</span>
        </div>
        <div class="modal-form-group full">
          <label class="modal-label">Phone Number</label>
          <input class="modal-input" type="text" id="phone" placeholder="10-digit phone number">
          <span class="field-err" id="phoneError">Please enter a valid phone number.</span>
        </div>
      </div>
    </div>
    <div class="modal-footer-inner">
      <button class="btn-outline-dark" id="closeAddModal2">Cancel</button>
      <button class="btn-gold" id="addAddressBtn"><i class="fa fa-plus" style="margin-right:0.4rem;"></i>Add Address</button>
    </div>
  </div>
</div>

<!-- ── EDIT ADDRESS MODAL ── -->
<div class="modal-overlay" id="editAddressModal">
  <div class="modal-box">
    <div class="modal-head">
      <span class="modal-head-title">Edit Address</span>
      <button class="modal-close" id="closeEditModal"><i class="fa fa-xmark"></i></button>
    </div>
    <div class="modal-body-inner">
      <input type="hidden" id="editAddressId">
      <div class="modal-form-grid">
        <div class="modal-form-group full">
          <label class="modal-label">Address Type</label>
          <div class="select-wrap">
            <select class="modal-select" id="editAddressType">
              <option value="">Select type</option>
              <option value="Home">Home</option>
              <option value="Work">Work</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <span class="field-err" id="addressTypeErrorr">Please select an address type.</span>
        </div>
        <div class="modal-form-group full">
          <label class="modal-label">Full Name</label>
          <input class="modal-input" type="text" id="EditName">
          <span class="field-err" id="nameErrorr">Please enter your name.</span>
        </div>
        <div class="modal-form-group full">
          <label class="modal-label">Street Address</label>
          <input class="modal-input" type="text" id="editStreetAddress">
          <span class="field-err" id="streetAddressErrorr">Please enter your street address.</span>
        </div>
        <div class="modal-form-group">
          <label class="modal-label">City</label>
          <input class="modal-input" type="text" id="editCity">
          <span class="field-err" id="cityErrorr">Please enter your city.</span>
        </div>
        <div class="modal-form-group">
          <label class="modal-label">Landmark</label>
          <input class="modal-input" type="text" id="editLandmark">
          <span class="field-err" id="landmarkErrorr">Please enter a landmark.</span>
        </div>
        <div class="modal-form-group">
          <label class="modal-label">State</label>
          <input class="modal-input" type="text" id="editState">
          <span class="field-err" id="stateErrorr">Please enter your state.</span>
        </div>
        <div class="modal-form-group">
          <label class="modal-label">Pincode</label>
          <input class="modal-input" type="text" id="editPincode">
          <span class="field-err" id="pincodeErrorr">Please enter a valid 6-digit pincode.</span>
        </div>
        <div class="modal-form-group full">
          <label class="modal-label">Phone Number</label>
          <input class="modal-input" type="text" id="editPhone">
          <span class="field-err" id="phoneErrorr">Please enter a valid phone number.</span>
        </div>
      </div>
    </div>
    <div class="modal-footer-inner">
      <button class="btn-outline-dark" id="closeEditModal2">Cancel</button>
      <button class="btn-gold" id="editSaveBtn"><i class="fa fa-floppy-disk" style="margin-right:0.4rem;"></i>Save Changes</button>
    </div>
  </div>
</div>

<script>
  // Active sidebar
  const currentPage = window.location.pathname;
  const pages = { "/user-profile":"profile", "/user-address":"address-book", "/user-order":"order-details", "/user-coupon":"coupon", "/user-wallet":"wallet" };
  for (let p in pages) { if (currentPage === p) { const el = document.getElementById(pages[p]); if(el) el.classList.add('active'); } }

  // Modal helpers
  function openModal(id) { document.getElementById(id).classList.add('open'); }
  function closeModal(id) { document.getElementById(id).classList.remove('open'); }

  document.getElementById('openAddModal').onclick = () => openModal('addAddressModal');
  document.getElementById('closeAddModal').onclick = () => closeModal('addAddressModal');
  document.getElementById('closeAddModal2').onclick = () => closeModal('addAddressModal');
  document.getElementById('closeEditModal').onclick = () => closeModal('editAddressModal');
  document.getElementById('closeEditModal2').onclick = () => closeModal('editAddressModal');

  // Close on overlay click
  ['addAddressModal','editAddressModal'].forEach(id => {
    document.getElementById(id).addEventListener('click', function(e) {
      if (e.target === this) closeModal(id);
    });
  });

  // Show/hide error helpers
  function showErr(id, msg) {
    const el = document.getElementById(id);
    if (msg) el.textContent = msg;
    el.style.display = 'block';
  }
  function hideAll(ids) { ids.forEach(id => { const el = document.getElementById(id); if(el) el.style.display = 'none'; }); }

  // ── ADD ADDRESS ──
  document.getElementById('addAddressBtn').addEventListener('click', function() {
    const fields = ['addressType','name','streetAddress','city','landmark','state','pincode','phone'];
    const errors = fields.map(f => f + 'Error');
    hideAll(errors);

    const vals = {};
    fields.forEach(f => vals[f] = document.getElementById(f).value.trim());

    let valid = true;
    if (!vals.addressType) { showErr('addressTypeError'); valid = false; }
    if (!vals.name)        { showErr('nameError'); valid = false; }
    if (!vals.streetAddress) { showErr('streetAddressError'); valid = false; }
    if (!vals.city)        { showErr('cityError'); valid = false; }
    if (!vals.landmark)    { showErr('landmarkError'); valid = false; }
    if (!vals.state)       { showErr('stateError'); valid = false; }
    if (!vals.pincode || !/^\d{6}$/.test(vals.pincode)) { showErr('pincodeError', 'Enter a valid 6-digit pincode.'); valid = false; }
    if (!vals.phone || !/^\d{10}$/.test(vals.phone))    { showErr('phoneError', 'Enter a valid 10-digit phone number.'); valid = false; }
    if (!valid) return;

    fetch('/user-address-add', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(vals)
    })
    .then(r => r.json())
    .then(data => {
      if (data.success) {
        Swal.fire({ icon:'success', title:'Address Added', text: data.message, confirmButtonColor:'#c9a96e', timer:2000, showConfirmButton:false })
          .then(() => location.reload());
      } else {
        Swal.fire({ icon:'error', title:'Error', text: data.message, confirmButtonColor:'#c9a96e' });
      }
    })
    .catch(() => Swal.fire({ icon:'error', title:'Error', text:'Something went wrong.', confirmButtonColor:'#c9a96e' }));
  });

  // ── DELETE ──
  document.querySelectorAll('.deleteAddressBtn').forEach(btn => {
    btn.addEventListener('click', function() {
      const id = this.dataset.id;
      Swal.fire({
        title: 'Remove Address?',
        text: 'This action cannot be undone.',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#c9a96e',
        cancelButtonColor: '#8a7968',
        confirmButtonText: 'Yes, remove it'
      }).then(result => {
        if (result.isConfirmed) {
          fetch(`/user-address/${id}`, { method: 'DELETE' })
            .then(r => r.json())
            .then(data => {
              if (data.success) {
                Swal.fire({ icon:'success', title:'Removed', text:'Address deleted.', confirmButtonColor:'#c9a96e', timer:1800, showConfirmButton:false })
                  .then(() => location.reload());
              } else {
                Swal.fire({ icon:'error', title:'Failed', text: data.message, confirmButtonColor:'#c9a96e' });
              }
            });
        }
      });
    });
  });

  // ── EDIT — populate modal ──
  document.querySelectorAll('.editAddressButton').forEach(btn => {
    btn.addEventListener('click', function() {
      document.getElementById('editAddressId').value       = this.dataset.addressid;
      document.getElementById('editAddressType').value     = this.dataset.addresstype;
      document.getElementById('EditName').value            = this.dataset.name;
      document.getElementById('editStreetAddress').value   = this.dataset.streetaddress;
      document.getElementById('editCity').value            = this.dataset.city;
      document.getElementById('editLandmark').value        = this.dataset.landmark;
      document.getElementById('editState').value           = this.dataset.state;
      document.getElementById('editPincode').value         = this.dataset.pincode;
      document.getElementById('editPhone').value           = this.dataset.phone;
      openModal('editAddressModal');
    });
  });

  // ── SAVE EDIT ──
  document.getElementById('editSaveBtn').addEventListener('click', function() {
    const errIds = ['addressTypeErrorr','nameErrorr','streetAddressErrorr','cityErrorr','landmarkErrorr','stateErrorr','pincodeErrorr','phoneErrorr'];
    hideAll(errIds);

    const addressId     = document.getElementById('editAddressId').value;
    const addressType   = document.getElementById('editAddressType').value.trim();
    const name          = document.getElementById('EditName').value.trim();
    const streetAddress = document.getElementById('editStreetAddress').value.trim();
    const city          = document.getElementById('editCity').value.trim();
    const landmark      = document.getElementById('editLandmark').value.trim();
    const state         = document.getElementById('editState').value.trim();
    const pincode       = document.getElementById('editPincode').value.trim();
    const phone         = document.getElementById('editPhone').value.trim();

    let valid = true;
    if (!addressType)   { showErr('addressTypeErrorr'); valid = false; }
    if (!name)          { showErr('nameErrorr'); valid = false; }
    if (!streetAddress) { showErr('streetAddressErrorr'); valid = false; }
    if (!city)          { showErr('cityErrorr'); valid = false; }
    if (!landmark)      { showErr('landmarkErrorr'); valid = false; }
    if (!state)         { showErr('stateErrorr'); valid = false; }
    if (!pincode || !/^\d{6}$/.test(pincode)) { showErr('pincodeErrorr','Enter a valid 6-digit pincode.'); valid = false; }
    if (!phone   || !/^\d{10}$/.test(phone))  { showErr('phoneErrorr','Enter a valid 10-digit phone number.'); valid = false; }
    if (!valid) return;

    fetch('/user-address-edit', {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ addressId, addressType, name, streetAddress, city, landmark, state, pincode, phone })
    })
    .then(r => r.json())
    .then(data => {
      if (data.success) {
        Swal.fire({ icon:'success', title:'Updated', text:'Address saved successfully.', confirmButtonColor:'#c9a96e', timer:1800, showConfirmButton:false })
          .then(() => { closeModal('editAddressModal'); location.reload(); });
      } else {
        Swal.fire({ icon:'error', title:'Error', text: data.message, confirmButtonColor:'#c9a96e' });
      }
    })
    .catch(() => Swal.fire({ icon:'error', title:'Error', text:'Something went wrong.', confirmButtonColor:'#c9a96e' }));
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>
</html>
