<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Labelle</title>
    <link rel="icon" href="img/core-img/favicon.ico">

    <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --cream: #f9f4ee;
      --warm-white: #fdf9f5;
      --gold: #c9a96e;
      --gold-light: #e8d5b0;
      --dark: #1a1410;
      --muted: #8a7968;
      --border: rgba(201,169,110,0.25);
      --panel-bg: #fff8f2;
    }

    html { scroll-behavior: smooth; }

    body {
      font-family: 'Jost', sans-serif;
      background: var(--warm-white);
      color: var(--dark);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ── NAVBAR ── */


    /* ── PAGE ── */
    .page-wrapper {
      padding-top: 72px;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    /* ── BANNER ── */
  

    /* ── CENTERED AREA ── */
    .form-area {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 3rem 5vw 4rem;
    }

    /* ── OTP CARD ── */
    .otp-card {
      background: var(--panel-bg);
      border: 1px solid var(--border);
      width: 100%;
      max-width: 440px;
      overflow: hidden;
      animation: fadeUp 0.8s cubic-bezier(0.22,1,0.36,1) both;
    }
    @keyframes fadeUp { from { opacity:0; transform:translateY(24px); } to { opacity:1; transform:translateY(0); } }

    .otp-card-header {
      padding: 1.6rem 2rem 1.4rem;
      border-bottom: 1px solid var(--border);
      background: linear-gradient(to right, rgba(201,169,110,0.06), transparent);
    }
    .card-eyebrow { font-size: 0.65rem; letter-spacing: 0.25em; text-transform: uppercase; color: var(--gold); margin-bottom: 0.3rem; }
    .card-title { font-family: 'Cormorant Garamond', serif; font-size: 1.6rem; font-weight: 300; color: var(--dark); }
    .card-subtitle { font-size: 0.78rem; color: var(--muted); font-weight: 300; margin-top: 0.4rem; line-height: 1.6; }

    /* ── CARD BODY ── */
    .otp-card-body { padding: 2rem; display: flex; flex-direction: column; gap: 1.6rem; }

    /* ── MESSAGE ── */
    .msg-box {
      display: none;
      padding: 0.75rem 1rem;
      font-size: 0.78rem;
      align-items: center;
      gap: 0.5rem;
      border-radius: 0;
    }
    .msg-box i { flex-shrink: 0; font-size: 0.85rem; }
    .msg-success { background: rgba(39,174,96,0.08); border: 1px solid rgba(39,174,96,0.25); color: #27ae60; }
    .msg-error   { background: rgba(192,57,43,0.07); border: 1px solid rgba(192,57,43,0.2);  color: #c0392b; }

    /* ── OTP INPUTS ── */
    .otp-inputs-label {
      font-size: 0.68rem; letter-spacing: 0.18em; text-transform: uppercase; color: var(--muted);
      margin-bottom: 0.9rem; display: block;
    }
    .otp-inputs {
      display: flex;
      justify-content: center;
      gap: 0.9rem;
    }
    .otp-input {
      width: 58px; height: 62px;
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.8rem; font-weight: 600;
      text-align: center;
      background: var(--warm-white);
      border: 1px solid var(--border);
      color: var(--dark);
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s, background 0.2s;
      caret-color: var(--gold);
    }
    .otp-input:focus {
      border-color: var(--gold);
      background: #fffdf8;
      box-shadow: 0 0 0 3px rgba(201,169,110,0.12);
    }
    .otp-input.filled {
      border-color: var(--gold);
      background: rgba(201,169,110,0.06);
    }
    .otp-input.error-input { border-color: #c0392b; }

    /* ── TIMER ── */
    .timer-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .timer-text {
      font-size: 0.75rem; color: var(--muted); font-weight: 300;
      display: flex; align-items: center; gap: 0.4rem;
    }
    .timer-text i { color: var(--gold); font-size: 0.72rem; }
    .countdown-val { color: var(--gold); font-weight: 500; }

    .btn-resend {
      background: transparent; border: 1px solid var(--border); color: var(--muted);
      font-family: 'Jost', sans-serif; font-size: 0.72rem; letter-spacing: 0.12em;
      text-transform: uppercase; padding: 0.4rem 1rem; cursor: pointer;
      display: inline-flex; align-items: center; gap: 0.35rem;
      transition: background 0.2s, border-color 0.2s, color 0.2s;
    }
    .btn-resend:hover:not(:disabled) { background: rgba(201,169,110,0.08); border-color: var(--gold); color: var(--dark); }
    .btn-resend:disabled { opacity: 0.38; cursor: not-allowed; }
    .btn-resend i { font-size: 0.7rem; color: var(--gold); }

    /* ── GOLD DIVIDER ── */
    .gold-divider { height: 1px; background: linear-gradient(to right, transparent, var(--gold), transparent); margin: 0 2rem; }

    /* ── FOOTER BUTTONS ── */
    .otp-card-footer { padding: 1.2rem 2rem 1.6rem; display: flex; flex-direction: column; gap: 0.8rem; }

    .btn-gold {
      width: 100%; padding: 0.85rem;
      background: var(--gold); color: var(--dark); border: none;
      font-family: 'Jost', sans-serif; font-size: 0.78rem;
      letter-spacing: 0.18em; text-transform: uppercase; font-weight: 500;
      cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.5rem;
      transition: background 0.2s, transform 0.2s;
    }
    .btn-gold:hover { background: var(--gold-light); transform: translateY(-1px); }

    .btn-back-link {
      text-align: center; font-size: 0.73rem;
      letter-spacing: 0.12em; text-transform: uppercase; color: var(--muted);
      text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 0.45rem;
      transition: color 0.2s; background: none; border: none; cursor: pointer; width: 100%;
    }
    .btn-back-link:hover { color: var(--dark); }
    .btn-back-link i { color: var(--gold); font-size: 0.72rem; }

    /* ── RESPONSIVE ── */
    @media (max-width: 600px) {
      .otp-input { width: 48px; height: 54px; font-size: 1.5rem; }
      .otp-inputs { gap: 0.6rem; }
    }
    </style>
</head>
<body>
  
<!-- ── NAVBAR ── -->

<div class="page-wrapper">


  <!-- ── FORM AREA ── -->
  <div class="form-area">
    <div class="otp-card">

      <div class="otp-card-header">
        <p class="card-eyebrow">One-Time Password</p>
        <h2 class="card-title">Enter OTP</h2>
        <p class="card-subtitle">We've sent a 4-digit code to your registered email. Please enter it below to continue.</p>
      </div>

      <div class="otp-card-body">

        <!-- Message -->
        <div class="msg-box" id="msgBox">
          <i class="fa" id="msgIcon"></i>
          <span id="msgText"></span>
        </div>

        <!-- OTP Inputs -->
        <div>
          <span class="otp-inputs-label">Enter your 4-digit code</span>
          <div class="otp-inputs">
            <input type="text" id="otp-1" maxlength="1" class="otp-input" inputmode="numeric" autofocus>
            <input type="text" id="otp-2" maxlength="1" class="otp-input" inputmode="numeric">
            <input type="text" id="otp-3" maxlength="1" class="otp-input" inputmode="numeric">
            <input type="text" id="otp-4" maxlength="1" class="otp-input" inputmode="numeric">
          </div>
        </div>

        <!-- Timer + Resend -->
        <div class="timer-row">
          <span class="timer-text" id="timerText">
            <i class="fa fa-clock"></i>
            Resend in <span class="countdown-val" id="countdownVal">59</span>s
          </span>
          <button class="btn-resend" id="resendOtpBtn" onclick="resendOtp()" disabled>
            <i class="fa fa-rotate-right"></i> Resend OTP
          </button>
        </div>

      </div>

      <div class="gold-divider"></div>

      <div class="otp-card-footer">
        <button class="btn-gold" onclick="verifyOtp()">
          <i class="fa fa-shield-halved"></i> Verify OTP
        </button>
        <a href="/login" class="btn-back-link">
          <i class="fa fa-arrow-left"></i> Back to Login
        </a>
      </div>

    </div>
  </div>
</div>
    <script>
  let countdown = 59;
  const countdownVal  = document.getElementById('countdownVal');
  const timerText     = document.getElementById('timerText');
  const resendOtpBtn  = document.getElementById('resendOtpBtn');
  const msgBox        = document.getElementById('msgBox');
  const msgIcon       = document.getElementById('msgIcon');
  const msgText       = document.getElementById('msgText');

  // ── Message helper ──
  function showMsg(type, text) {
    msgBox.className = 'msg-box ' + (type === 'success' ? 'msg-success' : 'msg-error');
    msgIcon.className = 'fa ' + (type === 'success' ? 'fa-circle-check' : 'fa-circle-exclamation');
    msgText.textContent = text;
    msgBox.style.display = 'flex';
  }
  function clearMsg() { msgBox.style.display = 'none'; }

  // ── OTP input behaviour ──
  const otpInputs = document.querySelectorAll('.otp-input');

  otpInputs.forEach((input, index) => {
    input.addEventListener('input', () => {
      input.value = input.value.replace(/\D/g, '').slice(0, 1);
      input.classList.toggle('filled', input.value !== '');
      input.classList.remove('error-input');
      if (input.value && index < otpInputs.length - 1) otpInputs[index + 1].focus();
    });
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Backspace' && !input.value && index > 0) {
        otpInputs[index - 1].focus();
      }
    });
    // allow paste across boxes
    input.addEventListener('paste', (e) => {
      e.preventDefault();
      const pasted = (e.clipboardData || window.clipboardData).getData('text').replace(/\D/g, '').slice(0, 4);
      pasted.split('').forEach((ch, i) => {
        if (otpInputs[i]) {
          otpInputs[i].value = ch;
          otpInputs[i].classList.add('filled');
        }
      });
      const nextEmpty = [...otpInputs].findIndex(el => !el.value);
      if (nextEmpty !== -1) otpInputs[nextEmpty].focus();
      else otpInputs[otpInputs.length - 1].focus();
    });
  });

  // ── Countdown ──
  function startCountdown() {
    countdown = 59;
    countdownVal.textContent = countdown;
    timerText.style.display = 'flex';
    resendOtpBtn.disabled = true;

    const interval = setInterval(() => {
      countdown--;
      countdownVal.textContent = countdown;
      if (countdown <= 0) {
        clearInterval(interval);
        timerText.style.display = 'none';
        resendOtpBtn.disabled = false;
      }
    }, 1000);
  }
  startCountdown();

  // ── Resend ──
  async function resendOtp() {
    clearMsg();
    try {
      const res    = await fetch('/resendforgotpasswordOtp', { method: 'POST', headers: { 'Content-Type': 'application/json' } });
      const result = await res.json();
      if (result.success) {
        showMsg('success', 'OTP resent successfully. Please check your email.');
        otpInputs.forEach(i => { i.value = ''; i.classList.remove('filled','error-input'); });
        otpInputs[0].focus();
        startCountdown();
      } else {
        showMsg('error', result.message || 'Error resending OTP.');
      }
    } catch {
      showMsg('error', 'Error resending OTP. Please try again.');
    }
  }

  // ── Verify ──
  async function verifyOtp() {
    clearMsg();
    const otp = [...otpInputs].map(i => i.value).join('');

    if (otp.length !== 4) {
      otpInputs.forEach(i => { if (!i.value) i.classList.add('error-input'); });
      showMsg('error', 'Please enter the complete 4-digit OTP.');
      return;
    }

    try {
      const res    = await fetch('/validateForgetPasswordOtp', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ otp })
      });
      const result = await res.json();

      if (result.success) {
        showMsg('success', 'OTP verified successfully! Redirecting…');
        setTimeout(() => { window.location.href = '/login'; }, 1200);
      } else {
        otpInputs.forEach(i => i.classList.add('error-input'));
        showMsg('error', result.message || 'Invalid OTP. Please try again.');
      }
    } catch {
      showMsg('error', 'Error verifying OTP. Please try again.');
    }
  }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</body>
</html>
