<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Labelle — Change Password</title>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=Jost:wght@300;400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --cream: #f9f4ee;
      --warm-white: #fdf9f5;
      --gold: #c9a96e;
      --gold-light: #e8d5b0;
      --dark: #1a1410;
      --muted: #8a7968;
      --border: rgba(201,169,110,0.25);
      --panel-bg: #fff8f2;
    }

    html { scroll-behavior: smooth; }
    body {
      font-family: 'Jost', sans-serif;
      background: var(--warm-white);
      color: var(--dark);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ── NAVBAR ── */
    nav {
      position: fixed; top: 0; left: 0; right: 0; z-index: 100;
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 5vw; height: 72px;
      background: rgba(253,249,245,0.92);
      backdrop-filter: blur(14px);
      border-bottom: 1px solid var(--border);
    }
    .nav-logo { font-family: 'Cormorant Garamond', serif; font-size: 1.7rem; font-weight: 600; letter-spacing: 0.12em; color: var(--dark); text-decoration: none; }
    .nav-logo span { color: var(--gold); }
    .nav-links { display: flex; gap: 2.4rem; list-style: none; }
    .nav-links a { text-decoration: none; font-size: 0.78rem; font-weight: 400; letter-spacing: 0.14em; text-transform: uppercase; color: var(--muted); transition: color 0.2s; }
    .nav-links a:hover { color: var(--gold); }
    .nav-actions { display: flex; align-items: center; gap: 1.4rem; }
    .nav-actions a { text-decoration: none; font-size: 0.75rem; letter-spacing: 0.12em; text-transform: uppercase; color: var(--muted); transition: color 0.2s; }
    .nav-actions a:hover { color: var(--dark); }

    /* ── PAGE ── */
    .page-wrapper {
      padding-top: 72px;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    /* ── BANNER ── */
    .page-banner {
      background: linear-gradient(135deg, #1a1410 0%, #2e1f10 40%, #4a2e18 70%, #1a1410 100%);
      padding: 3.5rem 5vw 3rem; position: relative; overflow: hidden;
    }
    .page-banner::before {
      content: ''; position: absolute; top: -60%; right: -5%; width: 50vw; height: 50vw;
      border-radius: 50%; background: radial-gradient(circle, rgba(201,169,110,0.15) 0%, transparent 65%); pointer-events: none;
    }
    .banner-inner { position: relative; z-index: 1; }
    .banner-eyebrow { font-size: 0.68rem; letter-spacing: 0.3em; text-transform: uppercase; color: var(--gold); margin-bottom: 0.6rem; }
    .banner-title { font-family: 'Cormorant Garamond', serif; font-size: clamp(2rem, 4vw, 3rem); font-weight: 300; color: var(--cream); line-height: 1.1; }
    .banner-title em { font-style: italic; color: var(--gold-light); }

    /* ── CENTERED FORM AREA ── */
    .form-area {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 3rem 5vw 4rem;
    }

    /* ── FORM CARD ── */
    .form-card {
      background: var(--panel-bg);
      border: 1px solid var(--border);
      width: 100%;
      max-width: 480px;
      overflow: hidden;
      animation: fadeUp 0.8s cubic-bezier(0.22,1,0.36,1) both;
    }
    @keyframes fadeUp { from { opacity:0; transform:translateY(24px); } to { opacity:1; transform:translateY(0); } }

    .form-card-header {
      padding: 1.6rem 2rem 1.4rem;
      border-bottom: 1px solid var(--border);
      background: linear-gradient(to right, rgba(201,169,110,0.06), transparent);
    }
    .form-card-eyebrow { font-size: 0.65rem; letter-spacing: 0.25em; text-transform: uppercase; color: var(--gold); margin-bottom: 0.3rem; }
    .form-card-title { font-family: 'Cormorant Garamond', serif; font-size: 1.6rem; font-weight: 300; color: var(--dark); }

    .form-card-body { padding: 2rem; display: flex; flex-direction: column; gap: 1.2rem; }

    /* ── FORM GROUPS ── */
    .form-group { display: flex; flex-direction: column; gap: 0.45rem; }
    .form-label { font-size: 0.68rem; letter-spacing: 0.18em; text-transform: uppercase; color: var(--muted); }

    .input-wrap { position: relative; }
    .form-input {
      width: 100%; padding: 0.78rem 2.8rem 0.78rem 1rem;
      background: var(--warm-white);
      border: 1px solid var(--border);
      color: var(--dark);
      font-family: 'Jost', sans-serif;
      font-size: 0.88rem; font-weight: 300;
      outline: none;
      transition: border-color 0.2s, background 0.2s;
    }
    .form-input:focus { border-color: var(--gold); background: #fffdf8; }
    .form-input.error-field { border-color: #c0392b; }
    .form-input::placeholder { color: rgba(138,121,104,0.45); }

    /* toggle eye icon */
    .toggle-eye {
      position: absolute; right: 0.9rem; top: 50%; transform: translateY(-50%);
      background: none; border: none; cursor: pointer;
      color: var(--muted); font-size: 0.82rem; padding: 0;
      transition: color 0.2s;
    }
    .toggle-eye:hover { color: var(--gold); }

    /* password strength bar */
    .strength-bar-wrap { display: none; margin-top: 0.4rem; }
    .strength-bar-track { height: 3px; background: var(--border); }
    .strength-bar-fill { height: 100%; width: 0%; transition: width 0.4s, background 0.4s; }
    .strength-hint { font-size: 0.65rem; color: var(--muted); margin-top: 0.3rem; letter-spacing: 0.05em; }

    /* inline error */
    .field-err { font-size: 0.7rem; color: #c0392b; display: none; margin-top: 0.1rem; }

    /* ── ERROR BANNER ── */
    .error-banner {
      display: none;
      background: rgba(192,57,43,0.07);
      border: 1px solid rgba(192,57,43,0.25);
      padding: 0.8rem 1rem;
      font-size: 0.78rem;
      color: #c0392b;
      display: none;
      align-items: center;
      gap: 0.5rem;
    }
    .error-banner i { font-size: 0.85rem; flex-shrink: 0; }

    /* ── BUTTONS ── */
    .form-card-footer {
      padding: 1.2rem 2rem 1.6rem;
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
    }
    .btn-gold {
      width: 100%; padding: 0.85rem;
      background: var(--gold); color: var(--dark); border: none;
      font-family: 'Jost', sans-serif; font-size: 0.78rem;
      letter-spacing: 0.18em; text-transform: uppercase; font-weight: 500;
      cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.5rem;
      transition: background 0.2s, transform 0.2s;
    }
    .btn-gold:hover { background: var(--gold-light); transform: translateY(-1px); }

    .btn-back-link {
      text-align: center; font-size: 0.73rem;
      letter-spacing: 0.12em; text-transform: uppercase; color: var(--muted);
      text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 0.45rem;
      transition: color 0.2s;
    }
    .btn-back-link:hover { color: var(--dark); }
    .btn-back-link i { color: var(--gold); font-size: 0.72rem; }

    /* ── GOLD DIVIDER ── */
    .gold-divider { height: 1px; background: linear-gradient(to right, transparent, var(--gold), transparent); margin: 0 2rem; }

    /* ── RESPONSIVE ── */
    @media (max-width: 600px) { .nav-links { display: none; } }
  </style>
</head>
<body>

<!-- ── NAVBAR ── -->
<nav>
  <a href="/" class="nav-logo">La<span>belle</span></a>
  <ul class="nav-links">
    <li><a href="/">Home</a></li>
    <li><a href="/shop">Shop</a></li>
    <li><a href="#">Contact</a></li>
  </ul>
  <div class="nav-actions">
    <a href="/user-profile">Profile</a>
  </div>
</nav>

<div class="page-wrapper">

  <!-- ── BANNER ── -->
  <div class="page-banner">
    <div class="banner-inner">
      <p class="banner-eyebrow">Account / Security</p>
      <h1 class="banner-title">Change <em>Password</em></h1>
    </div>
  </div>

  <!-- ── FORM AREA ── -->
  <div class="form-area">
    <div class="form-card">

      <div class="form-card-header">
        <p class="form-card-eyebrow">Security</p>
        <h2 class="form-card-title">Update your password</h2>
      </div>

      <form id="resetPasswordForm">
        <div class="form-card-body">

          <!-- Error banner -->
          <div class="error-banner" id="errorBanner">
            <i class="fa fa-circle-exclamation"></i>
            <span id="errorText"></span>
          </div>

          <!-- Current password -->
          <div class="form-group">
            <label class="form-label" for="currentPassword">Current Password</label>
            <div class="input-wrap">
              <input class="form-input" type="password" id="currentPassword" name="currentPassword" placeholder="Enter your current password">
              <button type="button" class="toggle-eye" onclick="toggleVisibility('currentPassword', this)">
                <i class="fa fa-eye"></i>
              </button>
            </div>
            <span class="field-err" id="errCurrent"></span>
          </div>

          <!-- New password -->
          <div class="form-group">
            <label class="form-label" for="newPassword">New Password</label>
            <div class="input-wrap">
              <input class="form-input" type="password" id="newPassword" name="newPassword" placeholder="Min 8 chars, letter, number & symbol" oninput="checkStrength(this.value)">
              <button type="button" class="toggle-eye" onclick="toggleVisibility('newPassword', this)">
                <i class="fa fa-eye"></i>
              </button>
            </div>
            <div class="strength-bar-wrap" id="strengthWrap">
              <div class="strength-bar-track">
                <div class="strength-bar-fill" id="strengthFill"></div>
              </div>
              <span class="strength-hint" id="strengthHint"></span>
            </div>
            <span class="field-err" id="errNew"></span>
          </div>

          <!-- Confirm password -->
          <div class="form-group">
            <label class="form-label" for="confirmPassword">Confirm New Password</label>
            <div class="input-wrap">
              <input class="form-input" type="password" id="confirmPassword" name="confirmPassword" placeholder="Re-enter your new password">
              <button type="button" class="toggle-eye" onclick="toggleVisibility('confirmPassword', this)">
                <i class="fa fa-eye"></i>
              </button>
            </div>
            <span class="field-err" id="errConfirm"></span>
          </div>

        </div>

        <div class="gold-divider"></div>

        <div class="form-card-footer">
          <button type="submit" class="btn-gold">
            <i class="fa fa-lock"></i> Update Password
          </button>
          <a href="/user-profile" class="btn-back-link">
            <i class="fa fa-arrow-left"></i> Back to Profile
          </a>
        </div>
      </form>

    </div>
  </div>
</div>

<script>
  // Toggle password visibility
  function toggleVisibility(inputId, btn) {
    const input = document.getElementById(inputId);
    const icon  = btn.querySelector('i');
    if (input.type === 'password') {
      input.type = 'text';
      icon.classList.replace('fa-eye', 'fa-eye-slash');
    } else {
      input.type = 'password';
      icon.classList.replace('fa-eye-slash', 'fa-eye');
    }
  }

  // Password strength indicator
  function checkStrength(val) {
    const wrap = document.getElementById('strengthWrap');
    const fill = document.getElementById('strengthFill');
    const hint = document.getElementById('strengthHint');

    if (!val) { wrap.style.display = 'none'; return; }
    wrap.style.display = 'block';

    let score = 0;
    if (val.length >= 8)  score++;
    if (/[A-Za-z]/.test(val)) score++;
    if (/\d/.test(val))   score++;
    if (/[^A-Za-z0-9]/.test(val)) score++;

    const levels = [
      { pct: '20%', color: '#c0392b', label: 'Too weak' },
      { pct: '45%', color: '#e67e22', label: 'Weak' },
      { pct: '70%', color: '#f1c40f', label: 'Moderate' },
      { pct: '100%', color: '#27ae60', label: 'Strong' },
    ];
    const lvl = levels[Math.min(score - 1, 3)] || levels[0];
    fill.style.width      = lvl.pct;
    fill.style.background = lvl.color;
    hint.textContent      = lvl.label;
    hint.style.color      = lvl.color;
  }

  // Field error helpers
  function showFieldErr(id, msg) {
    const el = document.getElementById(id);
    el.textContent = msg;
    el.style.display = 'block';
  }
  function clearFieldErrs() {
    ['errCurrent','errNew','errConfirm'].forEach(id => {
      const el = document.getElementById(id);
      el.style.display = 'none';
      el.textContent = '';
    });
    ['currentPassword','newPassword','confirmPassword'].forEach(id => {
      document.getElementById(id).classList.remove('error-field');
    });
    document.getElementById('errorBanner').style.display = 'none';
  }
  function showBanner(msg) {
    const banner = document.getElementById('errorBanner');
    document.getElementById('errorText').textContent = msg;
    banner.style.display = 'flex';
  }

  // Submit
  const form = document.getElementById('resetPasswordForm');
  const passwordRegex = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?])[A-Za-z\d!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]{8,}$/;

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    clearFieldErrs();

    const currentPassword = document.getElementById('currentPassword').value.trim();
    const newPassword     = document.getElementById('newPassword').value.trim();
    const confirmPassword = document.getElementById('confirmPassword').value.trim();

    let valid = true;

    if (!currentPassword) {
      showFieldErr('errCurrent', 'Current password is required.');
      document.getElementById('currentPassword').classList.add('error-field');
      valid = false;
    }
    if (!newPassword) {
      showFieldErr('errNew', 'New password is required.');
      document.getElementById('newPassword').classList.add('error-field');
      valid = false;
    } else if (!passwordRegex.test(newPassword)) {
      showFieldErr('errNew', 'Must be 8+ chars with a letter, number & special character.');
      document.getElementById('newPassword').classList.add('error-field');
      valid = false;
    }
    if (newPassword && confirmPassword && newPassword !== confirmPassword) {
      showFieldErr('errConfirm', 'Passwords do not match.');
      document.getElementById('confirmPassword').classList.add('error-field');
      valid = false;
    }
    if (!valid) return;

    try {
      const response = await fetch('/change-password', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ currentPassword, newPassword, confirmPassword })
      });
      const result = await response.json();

      if (result.success) {
        Swal.fire({
          icon: 'success',
          title: 'Password Updated',
          text: 'Your password has been changed successfully.',
          confirmButtonColor: '#c9a96e',
          confirmButtonText: 'Back to Profile'
        }).then(() => { window.location.href = '/user-profile'; });
      } else {
        Swal.fire({
          icon: 'error',
          title: 'Error',
          text: result.message || 'Something went wrong. Please try again.',
          confirmButtonColor: '#c9a96e'
        });
      }
    } catch (err) {
      console.error(err);
      showBanner('Failed to connect to the server. Please try again.');
    }
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>
</html>
