<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wishlist — Labelle</title>
  <link rel="icon" href="/img/core-img/favicon.ico">
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=Jost:wght@300;400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --cream: #f9f4ee;
      --warm-white: #fdf9f5;
      --gold: #c9a96e;
      --gold-light: #e8d5b0;
      --dark: #1a1410;
      --muted: #8a7968;
      --border: rgba(201,169,110,0.25);
    }

    html { scroll-behavior: smooth; }
    body {
      font-family: 'Jost', sans-serif;
      background: var(--warm-white);
      color: var(--dark);
      overflow-x: hidden;
    }

    /* ── NAVBAR ── */
    nav.main-nav {
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 200;
      height: 72px;
      background: rgba(253,249,245,0.92);
      backdrop-filter: blur(16px);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 5vw;
    }
    .nav-logo {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.7rem; font-weight: 600;
      letter-spacing: 0.12em; color: var(--dark); text-decoration: none;
    }
    .nav-logo span { color: var(--gold); }
    .nav-center { display: flex; align-items: center; }
    .nav-item > a {
      display: flex; align-items: center;
      padding: 0 1.4rem; height: 72px;
      font-size: 0.75rem; letter-spacing: 0.14em; text-transform: uppercase;
      color: var(--muted); text-decoration: none; transition: color 0.2s;
    }
    .nav-item > a:hover { color: var(--gold); }
    .nav-item > a.active-page { color: var(--dark); }
    .nav-right { display: flex; align-items: center; gap: 1.4rem; }
    .nav-right a, .nav-right button {
      font-size: 0.75rem; letter-spacing: 0.12em; text-transform: uppercase;
      color: var(--muted); text-decoration: none; background: none;
      border: none; cursor: pointer; font-family: 'Jost', sans-serif; transition: color 0.2s;
    }
    .nav-right a:hover, .nav-right button:hover { color: var(--dark); }

    /* ── PAGE HEADER ── */
    .page-header {
      margin-top: 72px;
      background: linear-gradient(135deg, #1a1410 0%, #2e1f10 60%, #1a1410 100%);
      padding: 4rem 5vw 3rem;
      position: relative;
      overflow: hidden;
    }
    .page-header::before {
      content: '';
      position: absolute;
      top: -30%; right: 0;
      width: 50vw; height: 200%;
      background: radial-gradient(circle at 70% 50%, rgba(201,169,110,0.1) 0%, transparent 60%);
      pointer-events: none;
    }
    .page-header-inner { position: relative; }
    .page-header-eyebrow {
      font-size: 0.68rem; letter-spacing: 0.3em;
      text-transform: uppercase; color: var(--gold); margin-bottom: 0.6rem;
    }
    .page-header h1 {
      font-family: 'Cormorant Garamond', serif;
      font-size: clamp(2rem, 4vw, 3rem);
      font-weight: 300; color: var(--cream); line-height: 1.1;
    }
    .page-header h1 em { font-style: italic; color: var(--gold-light); }

    /* ── BREADCRUMB ── */
    .breadcrumb-bar {
      padding: 1rem 5vw;
      background: var(--cream);
      border-bottom: 1px solid var(--border);
      display: flex; align-items: center; gap: 0.5rem;
      font-size: 0.72rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--muted);
    }
    .breadcrumb-bar a { color: var(--muted); text-decoration: none; transition: color 0.2s; }
    .breadcrumb-bar a:hover { color: var(--gold); }
    .breadcrumb-bar .sep { opacity: 0.4; }
    .breadcrumb-bar .current { color: var(--dark); }

    /* ── MAIN ── */
    .wishlist-body { padding: 4rem 5vw 6rem; }

    /* ── EMPTY STATE ── */
    .empty-wishlist {
      text-align: center;
      padding: 6rem 2rem;
    }
    .empty-icon {
      width: 72px; height: 72px;
      margin: 0 auto 1.6rem;
      background: var(--cream);
      border: 1px solid var(--border);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
    }
    .empty-icon svg { width: 28px; height: 28px; stroke: var(--muted); fill: none; }
    .empty-wishlist h2 {
      font-family: 'Cormorant Garamond', serif;
      font-size: 2rem; font-weight: 300; color: var(--dark); margin-bottom: 0.6rem;
    }
    .empty-wishlist p { font-size: 0.88rem; color: var(--muted); font-weight: 300; margin-bottom: 2rem; }
    .btn-shop {
      display: inline-flex; align-items: center; gap: 0.6rem;
      padding: 0.9rem 2.4rem; background: var(--dark); color: var(--cream);
      text-decoration: none; font-size: 0.75rem; letter-spacing: 0.18em;
      text-transform: uppercase; transition: background 0.25s;
    }
    .btn-shop:hover { background: var(--gold); }

    /* ── WISHLIST HEADER ROW ── */
    .wishlist-header-row {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 1.8rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border);
    }
    .wishlist-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.6rem; font-weight: 300; color: var(--dark);
    }
    .wishlist-count {
      font-size: 0.72rem; letter-spacing: 0.1em; color: var(--muted); font-weight: 300;
    }

    /* ── TABLE HEADER ── */
    .wl-table-head {
      display: grid;
      grid-template-columns: 110px 1fr 130px 130px 160px;
      gap: 1rem;
      padding-bottom: 0.8rem;
      border-bottom: 1px solid var(--border);
      margin-bottom: 0;
    }
    .wl-table-head span {
      font-size: 0.62rem; letter-spacing: 0.2em;
      text-transform: uppercase; color: var(--muted);
    }

    /* ── WISHLIST ITEM ── */
    .wl-item {
      display: grid;
      grid-template-columns: 110px 1fr 130px 130px 160px;
      gap: 1rem;
      align-items: center;
      padding: 1.6rem 0;
      border-bottom: 1px solid var(--border);
      animation: fadeIn 0.3s ease;
      transition: opacity 0.3s, transform 0.3s;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* image */
    .wl-img {
      width: 110px; height: 110px;
      overflow: hidden; background: var(--cream);
      position: relative;
    }
    .wl-img img {
      width: 100%; height: 100%;
      object-fit: cover; display: block;
      transition: transform 0.4s cubic-bezier(0.22,1,0.36,1);
    }
    .wl-item:hover .wl-img img { transform: scale(1.05); }

    /* product info */
    .wl-name {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.15rem; font-weight: 400; color: var(--dark);
      text-decoration: none; display: block; margin-bottom: 0.3rem;
      transition: color 0.2s;
    }
    .wl-name:hover { color: var(--gold); }
    .wl-variant {
      font-size: 0.72rem; color: var(--muted); letter-spacing: 0.06em;
    }

    /* price */
    .wl-price {
      font-size: 1rem; color: var(--dark);
    }
    .wl-price::before { content: '₹'; }

    /* stock */
    .stock-badge {
      display: inline-flex; align-items: center; gap: 0.4rem;
      font-size: 0.7rem; letter-spacing: 0.08em; text-transform: uppercase;
    }
    .stock-dot {
      width: 6px; height: 6px; border-radius: 50%;
    }
    .stock-badge.in .stock-dot { background: #43a047; }
    .stock-badge.in { color: #2e7d32; }
    .stock-badge.out .stock-dot { background: #e53935; }
    .stock-badge.out { color: #c0392b; }

    /* action buttons */
    .wl-actions { display: flex; flex-direction: column; gap: 0.6rem; }

    .btn-add-cart {
      display: flex; align-items: center; justify-content: center; gap: 0.5rem;
      padding: 0.65rem 1rem;
      background: var(--dark); color: var(--cream);
      border: none; font-family: 'Jost', sans-serif;
      font-size: 0.7rem; letter-spacing: 0.14em; text-transform: uppercase;
      cursor: pointer; transition: background 0.2s;
      white-space: nowrap;
    }
    .btn-add-cart:hover { background: var(--gold); }
    .btn-add-cart:disabled { background: #ccc; cursor: not-allowed; }

    .btn-remove {
      display: flex; align-items: center; justify-content: center; gap: 0.5rem;
      padding: 0.55rem 1rem;
      background: transparent; color: var(--muted);
      border: 1px solid var(--border); font-family: 'Jost', sans-serif;
      font-size: 0.68rem; letter-spacing: 0.12em; text-transform: uppercase;
      cursor: pointer; transition: border-color 0.2s, color 0.2s;
      white-space: nowrap;
    }
    .btn-remove:hover { border-color: #c0392b; color: #c0392b; }

    /* ── FOOTER ── */
    footer {
      background: #130e09;
      padding: 4rem 5vw 2rem;
      border-top: 1px solid rgba(201,169,110,0.1);
    }
    .footer-top {
      display: grid; grid-template-columns: 1.8fr 1fr 1fr 1fr;
      gap: 3rem; padding-bottom: 3rem;
      border-bottom: 1px solid rgba(255,255,255,0.06); margin-bottom: 2rem;
    }
    .footer-brand-logo {
      font-family: 'Cormorant Garamond', serif; font-size: 1.6rem;
      font-weight: 600; letter-spacing: 0.1em; color: var(--cream); margin-bottom: 1rem;
    }
    .footer-brand-logo span { color: var(--gold); }
    .footer-brand-text {
      font-size: 0.82rem; line-height: 1.8; color: rgba(249,244,238,0.35);
      font-weight: 300; max-width: 260px; margin-bottom: 1.6rem;
    }
    .social-links { display: flex; gap: 0.8rem; }
    .social-link {
      width: 34px; height: 34px; border: 1px solid rgba(201,169,110,0.25);
      display: flex; align-items: center; justify-content: center;
      transition: border-color 0.2s, background 0.2s; text-decoration: none;
    }
    .social-link:hover { border-color: var(--gold); background: rgba(201,169,110,0.1); }
    .social-link svg { width: 14px; height: 14px; stroke: var(--gold); fill: none; }
    .footer-col-title {
      font-size: 0.68rem; letter-spacing: 0.22em; text-transform: uppercase;
      color: var(--gold); margin-bottom: 1.4rem;
    }
    .footer-links { list-style: none; display: flex; flex-direction: column; gap: 0.7rem; }
    .footer-links a {
      text-decoration: none; font-size: 0.82rem; color: rgba(249,244,238,0.4);
      font-weight: 300; transition: color 0.2s;
    }
    .footer-links a:hover { color: var(--gold); }
    .footer-bottom {
      display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 1rem;
    }
    .footer-copy { font-size: 0.72rem; color: rgba(249,244,238,0.2); letter-spacing: 0.05em; }
    .footer-legal { display: flex; gap: 1.6rem; }
    .footer-legal a { font-size: 0.72rem; color: rgba(249,244,238,0.2); text-decoration: none; transition: color 0.2s; }
    .footer-legal a:hover { color: var(--gold); }

    /* ── RESPONSIVE ── */
    @media (max-width: 1024px) {
      .wl-table-head { display: none; }
      .wl-item {
        grid-template-columns: 90px 1fr;
        grid-template-rows: auto auto auto;
        gap: 0.6rem 1rem;
      }
      .wl-img { width: 90px; height: 90px; grid-row: 1 / 4; }
      .wl-price { grid-column: 2; }
      .stock-wrap { grid-column: 2; }
      .wl-actions { grid-column: 2; flex-direction: row; }
      .footer-top { grid-template-columns: 1fr 1fr; }
    }
    @media (max-width: 640px) {
      .wl-actions { flex-direction: column; }
      .footer-top { grid-template-columns: 1fr; gap: 2rem; }
    }
  </style>
</head>
<body>

<!-- ── NAVBAR ── -->
<nav class="main-nav">
  <a href="/" class="nav-logo">La<span>belle</span></a>
  <div class="nav-center">
    <div class="nav-item"><a href="/">Home</a></div>
    <div class="nav-item"><a href="/shop">Shop</a></div>
    <div class="nav-item"><a href="/cart">Cart</a></div>
    <div class="nav-item"><a href="/wishlist" class="active-page">Wishlist</a></div>
  </div>
  <div class="nav-right">
    <% if (user) { %>
      <a href="/logout">Logout</a>
      <a href="/user-profile">Profile</a>
    <% } else { %>
      <a href="/login">Login</a>
    <% } %>
  </div>
</nav>

<!-- ── PAGE HEADER ── -->
<div class="page-header">
  <div class="page-header-inner">
    <p class="page-header-eyebrow">Your Collection</p>
    <h1>My <em>Wishlist</em></h1>
  </div>
</div>

<!-- ── BREADCRUMB ── -->
<div class="breadcrumb-bar">
  <a href="/">Home</a>
  <span class="sep">›</span>
  <a href="/shop">Shop</a>
  <span class="sep">›</span>
  <span class="current">Wishlist</span>
</div>

<!-- ── WISHLIST BODY ── -->
<div class="wishlist-body">

  <% if (!wishlist || wishlist.items.length === 0) { %>

  <!-- EMPTY STATE -->
  <div class="empty-wishlist">
    <div class="empty-icon">
      <svg viewBox="0 0 24 24" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
      </svg>
    </div>
    <h2>Your wishlist is empty</h2>
    <p>Save your favourite fragrances here to revisit them anytime.</p>
    <a href="/shop" class="btn-shop">
      <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" fill="none" stroke-width="1.5"><path d="M19 12H5M12 5l-7 7 7 7" stroke-linecap="round" stroke-linejoin="round"/></svg>
      Browse Collection
    </a>
  </div>

  <% } else { %>

  <!-- HEADER ROW -->
  <div class="wishlist-header-row">
    <span class="wishlist-title">Saved Fragrances</span>
    <span class="wishlist-count"><%= wishlist.items.filter(i => i.variantId && i.variantId.productId).length %> item<%= wishlist.items.filter(i => i.variantId && i.variantId.productId).length !== 1 ? 's' : '' %></span>
  </div>

  <!-- TABLE HEAD -->
  <div class="wl-table-head">
    <span></span>
    <span>Product</span>
    <span>Price</span>
    <span>Stock</span>
    <span>Actions</span>
  </div>

  <!-- ITEMS -->
  <% wishlist.items.forEach(function(item) { %>
    <% if (item.variantId && item.variantId.productId) { %>
    <div class="wl-item" id="wl-row-<%= item.variantId._id %>">

      <!-- Image -->
      <div class="wl-img">
        <a href="/product-details/<%= item.variantId._id %>">
          <img src="<%= item.variantId.productId.images[0] %>" alt="<%= item.variantId.productId.name %>">
        </a>
      </div>

      <!-- Info -->
      <div>
        <a class="wl-name" href="/product-details/<%= item.variantId._id %>">
          <%= item.variantId.productId.name %>
        </a>
        <div class="wl-variant"><%= item.variantId.milliliter %> ml</div>
      </div>

      <!-- Price -->
      <div class="wl-price"><%= item.variantId.price %></div>

      <!-- Stock -->
      <div class="stock-wrap">
        <% if (item.variantId.stock > 0) { %>
          <span class="stock-badge in">
            <span class="stock-dot"></span>In Stock
          </span>
        <% } else { %>
          <span class="stock-badge out">
            <span class="stock-dot"></span>Out of Stock
          </span>
        <% } %>
      </div>

      <!-- Actions -->
      <div class="wl-actions">
        <button class="btn-add-cart"
          onclick="addWishlistToCart('<%= item.variantId._id %>')"
          <%= item.variantId.stock <= 0 ? 'disabled' : '' %>>
          <i class="fa fa-shopping-bag" style="font-size:0.7rem;"></i>
          Add to Cart
        </button>
        <button class="btn-remove" onclick="removeFromWishlist('<%= item.variantId._id %>')">
          <i class="fa fa-times" style="font-size:0.65rem;"></i>
          Remove
        </button>
      </div>

    </div>
    <% } %>
  <% }); %>

  <% } %>
</div>

<!-- ── FOOTER ── -->
<footer>
  <div class="footer-top">
    <div>
      <div class="footer-brand-logo">La<span>belle</span></div>
      <p class="footer-brand-text">Premium fragrances crafted to express your personality. Elegance, confidence, and beauty — in every drop.</p>
      <div class="social-links">
        <a href="#" class="social-link">
          <svg viewBox="0 0 24 24" stroke-width="1.5"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1112.63 8 4 4 0 0116 11.37zM17.5 6.5h.01" stroke-linecap="round"/></svg>
        </a>
        <a href="#" class="social-link">
          <svg viewBox="0 0 24 24" stroke-width="1.5"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg>
        </a>
        <a href="#" class="social-link">
          <svg viewBox="0 0 24 24" stroke-width="1.5"><path d="M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2c9 5 20 0 20-11.5a4.5 4.5 0 00-.08-.83A7.72 7.72 0 0023 3z" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </a>
      </div>
    </div>
    <div>
      <p class="footer-col-title">Shop</p>
      <ul class="footer-links">
        <li><a href="#">New Arrivals</a></li>
        <li><a href="#">Bestsellers</a></li>
        <li><a href="#">Collections</a></li>
        <li><a href="#">Gift Sets</a></li>
      </ul>
    </div>
    <div>
      <p class="footer-col-title">Help</p>
      <ul class="footer-links">
        <li><a href="#">Track Order</a></li>
        <li><a href="#">Returns</a></li>
        <li><a href="#">FAQ</a></li>
        <li><a href="#">Contact Us</a></li>
      </ul>
    </div>
    <div>
      <p class="footer-col-title">Company</p>
      <ul class="footer-links">
        <li><a href="#">About Labelle</a></li>
        <li><a href="#">Sustainability</a></li>
        <li><a href="#">Careers</a></li>
        <li><a href="#">Press</a></li>
      </ul>
    </div>
  </div>
  <div class="footer-bottom">
    <p class="footer-copy">© 2025 Labelle. All rights reserved.</p>
    <div class="footer-legal">
      <a href="#">Privacy Policy</a>
      <a href="#">Terms of Service</a>
    </div>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  function removeFromWishlist(variantId) {
    Swal.fire({
      title: 'Remove from wishlist?',
      text: 'This item will be removed from your saved collection.',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#1a1410',
      cancelButtonColor: '#8a7968',
      confirmButtonText: 'Remove',
      cancelButtonText: 'Keep it',
    }).then(result => {
      if (!result.isConfirmed) return;

      fetch('/wishlist-remove', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ variantId }),
      })
      .then(r => r.json())
      .then(data => {
        if (data.success) {
          const row = document.getElementById(`wl-row-${variantId}`);
          if (row) {
            row.style.opacity = '0';
            row.style.transform = 'translateX(20px)';
            setTimeout(() => {
              row.remove();
              // update count
              const remaining = document.querySelectorAll('[id^="wl-row-"]').length;
              const countEl = document.querySelector('.wishlist-count');
              if (countEl) countEl.textContent = `${remaining} item${remaining !== 1 ? 's' : ''}`;
              if (remaining === 0) location.reload();
            }, 300);
          }
        } else {
          Swal.fire({ title: 'Error!', text: 'Failed to remove item.', icon: 'error', confirmButtonColor: '#1a1410' });
        }
      })
      .catch(() => {
        Swal.fire({ title: 'Error!', text: 'Something went wrong. Please try again.', icon: 'error', confirmButtonColor: '#1a1410' });
      });
    });
  }

  function addWishlistToCart(variantId) {
    fetch('/cart-add', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ variantId, quantity: 1 }),
    })
    .then(r => r.json())
    .then(data => {
      if (data.success) {
        Swal.fire({
          title: 'Added to Cart!',
          text: data.message || 'Item added to your cart.',
          icon: 'success',
          confirmButtonText: 'View Cart',
          showCancelButton: true,
          cancelButtonText: 'Stay here',
          confirmButtonColor: '#1a1410',
          cancelButtonColor: '#8a7968',
        }).then(result => {
          if (result.isConfirmed) window.location.href = '/cart';
        });
      } else {
        Swal.fire({ title: 'Error!', text: data.message, icon: 'error', confirmButtonColor: '#1a1410' });
      }
    })
    .catch(() => {
      Swal.fire({ title: 'Error!', text: 'An unexpected error occurred.', icon: 'error', confirmButtonColor: '#1a1410' });
    });
  }
</script>
</body>
</html>
