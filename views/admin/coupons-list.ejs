<!DOCTYPE html>
<!--[if IE 8 ]><html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<!--<![endif]-->

<head>
    <!-- Basic Page Needs -->
    <meta charset="utf-8">
    <!--[if IE]><meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'><![endif]-->
        <title>labelle</title>

    <meta name="author" content="themesflat.com">

    <!-- Mobile Specific Metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!-- Theme Style -->
    <link rel="stylesheet" type="text/css" href="/css/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/css/animation.css">
    <link rel="stylesheet" type="text/css" href="/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="/css/bootstrap-select.min.css">
    <link rel="stylesheet" type="text/css" href="/css/style.css">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- Font -->
    <link rel="stylesheet" href="/font/fonts.css">

    <!-- Icon -->
    <link rel="stylesheet" href="/icon/style.css">

    <!-- Favicon and Touch Icons  -->
    <link rel="icon" href="/img/core-img/favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
</head>

<body class="body">

    <!-- #wrapper -->
    <div id="wrapper">
        <!-- #page -->
        <div id="page" class="">
            <!-- layout-wrap -->
           <div class="layout-wrap">
                <div class="section-menu-left">
                    <div class="box-logo">
                        <a href="/admin/dashboard" id="site-logo-inner">
                            <img class="" style="height: 97px;" alt="" src="/img/core-img/logo.png" data-light="/images/logo/logo.png" data-dark="/images/logo/logo-dark.png" >
                        </a>
                        <div class="button-show-hide">
                            <i class="icon-menu-left"></i>
                        </div>
                    </div>
                    <div class="center">
                        <div class="center-item">
                            <div class="center-heading">Main Home</div>
                            <ul class="menu-list">
                                <li class="menu-item has-children ">
                                    <a href="/admin/dashboard" class="menu-item-button">
                                        <div class="icon"><i class="icon-grid"></i></div>
                                        <div class="text">Dashboard</div>
                                    </a>
                                </li>
                            </ul>
                        </div>
                        <div class="center-item">
                            <div class="center-heading">All page</div>
                            <ul class="menu-list">
                                <li class="menu-item has-children">
                                    <a href="javascript:void(0);" class="menu-item-button">
                                        <div class="icon"><i class="icon-shopping-cart"></i></div>
                                        <div class="text">Ecommerce</div>
                                    </a>
                                    <ul class="sub-menu">
                                        <li class="sub-menu-item">
                                            <a href="/admin/add-product" class="">
                                                <div class="text">Add Product</div>
                                            </a>
                                        </li>
                                        <li class="sub-menu-item">
                                            <a href="/admin/product-list" class="">
                                                <div class="text">Product List</div>
                                            </a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="menu-item has-children">
                                    <a href="javascript:void(0);" class="menu-item-button">
                                        <div class="icon"><i class="icon-layers"></i></div>
                                        <div class="text">Category</div>
                                    </a>
                                    <ul class="sub-menu">
                                        <li class="sub-menu-item">
                                            <a href="/admin/fragrance-list" class="">
                                                <div class="text">Fragrance List</div>
                                            </a>
                                        </li>
                                        <li class="sub-menu-item">
                                            <a href="/admin/add-fragrance" class="">
                                                <div class="text">Add Fragrance Type</div>
                                            </a>
                                        </li>
                                        <li class="sub-menu-item">
                                            <a href="/admin/occasion-list" class="">
                                                <div class="text">Occasion List</div>
                                            </a>
                                        </li>
                                        <li class="sub-menu-item">
                                            <a href="/admin/add-occasion" class="">
                                                <div class="text">Add Occasion</div>
                                            </a>
                                        </li>
                                         <li class="sub-menu-item">
                                            <a href="/admin/milliliters-list" class="">
                                                <div class="text">Milliliters List</div>
                                            </a>
                                        </li>
                                        <li class="sub-menu-item">
                                            <a href="/admin/add-milliliters" class="">
                                                <div class="text">Add Milliliter</div>
                                            </a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="menu-item has-children">
                                    <a href="javascript:void(0);" class="menu-item-button">
                                        <div class="icon"><i class="icon-file-plus"></i></div>
                                        <div class="text">Order</div>
                                    </a>
                                    <ul class="sub-menu">
                                        <li class="sub-menu-item">
                                            <a href="/admin/order-list" class="">
                                                <div class="text">Order list</div>
                                            </a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="menu-item has-children">
                                    <a href="javascript:void(0);" class="menu-item-button">
                                        <div class="icon"><i class="icon-user"></i></div>
                                        <div class="text">User</div>
                                    </a>
                                    <ul class="sub-menu">
                                        <li class="sub-menu-item">
                                            <a href="/admin/all-user" class="">
                                                <div class="text">All user</div>
                                            </a>
                                        </li>
                                        
                                    </ul>
                                </li>
                                
                                <li class="menu-item has-children active">
                                    <a href="javascript:void(0);" class="menu-item-button">
                                        <div class="icon"><i class="fa fa-ticket"></i></div>
                                        <div class="text">Coupon</div>
                                    </a>
                                    <ul class="sub-menu">
                                        <li class="sub-menu-item">
                                            <a href="/admin/add-coupon" class="">
                                                <div class="text">Add coupon</div>
                                            </a>
                                        </li>
                                        <li class="sub-menu-item">
                                            <a href="/admin/coupons-list" class="">
                                                <div class="text">coupon List</div>
                                            </a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="menu-item has-children">
                                    <a href="javascript:void(0);" class="menu-item-button">
                                        <div class="icon"><i class="fa fa-gift"></i></div>
                                        <div class="text">Offer</div>
                                    </a>
                                    <ul class="sub-menu">
                                        <li class="sub-menu-item">
                                            <a href="/admin/offers-list" class="">
                                                <div class="text">Product Offer List</div>
                                            </a>
                                        </li>
                                        <li class="sub-menu-item">
                                            <a href="/admin/category-offer-list" class="">
                                                <div class="text">Category Offer List</div>
                                            </a>
                                        </li>
                                    </ul>

                                </li>
                            </ul>
                        </div>
                       
                <form action="/admin/logout" method="GET">
                    <button type="submit" style='background-color: #fbb710; font-size: 15px; padding: 9px 15px; border-radius: 8px; text-align: center;margin-left: 60px;  cursor: pointer;'>Logout</button>
                  </form>
                  
                
                    </div>
                </div>
                
                <!-- /section-menu-left -->
                <!-- section-content-right -->
                <div class="section-content-right">
                    <!-- header-dashboard -->
                    <div class="header-dashboard">
                        <div class="wrap">
                            <div class="header-left">
                                <a href="index.html">
                                    <img class="" id="logo_header_mobile" alt="" src="images/logo/logo.png" data-light="images/logo/logo.png" data-dark="images/logo/logo-dark.png" data-width="154px" data-height="52px" data-retina="images/logo/logo@2x.png">
                                </a>
                                <div class="button-show-hide">
                                    <i class="icon-menu-left"></i>
                                </div>
                               
                            </div>
                            <div class="header-grid">
                                
                                <div class="header-item button-dark-light">
                                    <i class="icon-moon"></i>
                                </div>
                                


                             
                                <div class="header-item button-zoom-maximize">
                                    <div class="">
                                        <i class="icon-maximize"></i>
                                    </div>
                                </div>
                               
                                <div class="popup-wrap user type-header">
                                    <div class="dropdown">
                                        <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton3" data-bs-toggle="dropdown" aria-expanded="false">
                                            <span class="header-user wg-user">
                                                <span class="image">
                                                    <img src="images/avatar/user-1.png" alt="">
                                                </span>
                                                <span class="flex flex-column">
                                                    <span class="body-title mb-2">Sayyida Jahan</span>
                                                    <span class="text-tiny">Admin</span>
                                                </span>
                                            </span>
                                        </button>
                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /header-dashboard -->
                    <!-- main-content -->
                    <div class="main-content">
                        <!-- main-content-wrap -->
                        <div class="main-content-inner">
                            <!-- main-content-wrap -->
                            <div class="main-content-wrap">
                                <div class="flex items-center flex-wrap justify-between gap20 mb-27">
                                    <h3>Coupon List</h3>
                                    <ul class="breadcrumbs flex items-center flex-wrap justify-start gap10">
                                        <li>
                                            <a href="/admin/dashboard"><div class="text-tiny">Dashboard</div></a>
                                        </li>
                                        <li>
                                            <i class="icon-chevron-right"></i>
                                        </li>
                                        <li>
                                            <a href="#"><div class="text-tiny">Coupon</div></a>
                                        </li>
                                        <li>
                                            <i class="icon-chevron-right"></i>
                                        </li>
                                        <li>
                                            <div class="text-tiny">Coupon List</div>
                                        </li>
                                    </ul>
                                </div>
                                <!-- product-list -->
                                <div class="wg-box">
                                    <div class="title-box">
                                       
                                        
                                    </div>
                                    <div class="flex items-center justify-between gap10 flex-wrap">
                                        <div class="wg-filter flex-grow">
                                            
                                            <form class="form-search" method="GET" action="/admin/coupons-list" >
                                                <fieldset class="name">
                                                 
                                                    <input type="text" placeholder="Search here..." class="" name="query" tabindex="2"  value="<%=query%>" aria-required="true" required="">
                                                </fieldset>
                                                <div class="button-submit">
                                                    <button class="" type="submit"><i class="icon-search"></i></button>
                                                </div>
                                            </form>
                                        </div>
                                        <a class="tf-button style-1 w208" href="/admin/add-coupon"><i class="icon-plus"></i>Add new</a>
                                    </div>
                                    <div style="width: 100%; padding: 20px; background-color: #ffffff; border-radius: 8px;">
                                      <ul style="display: flex; justify-content: space-between; margin-bottom: 20px; list-style: none; padding: 0;">
                                          <li style="font-weight: bold; width: 15%;">Code</li>    
                                          <li style="font-weight: bold; width: 20%;">Expired On</li>
                                          <li style="font-weight: bold; width: 15%;">Minimum Price</li>
                                          <li style="font-weight: bold; width: 15%;">Maximum Price</li>
                                          <li style="font-weight: bold; width: 15%;">Discount</li>
                                          <li style="font-weight: bold; width: 10%;">Status</li>
                                          <li style="font-weight: bold; width: 10%;">Action</li>
                                      </ul>
                                  
                                      <ul style="list-style: none; padding: 0;">
                                          <% coupons.forEach(coupon => { %>
                                          <li style="display: flex; justify-content: space-between; margin-bottom: 15px; padding: 10px; background-color: #ffffff; border-radius: 8px; ">
                                              <div style="width: 15%; font-size: 12px;"><%= coupon.code %></div>
                                              <div style="width: 20%; font-size: 12px;"><%= new Date(coupon.expireOn).toISOString().slice(0, 10) %></div>
                                              <div style="width: 15%; font-size: 12px;"><%= coupon.minimumPrice %></div>
                                              <div style="width: 15%; font-size: 12px;"><%= coupon.maximumPrice %></div>
                                              <div style="width: 15%; font-size: 12px;"><%= coupon.discount %>%</div>
                                              <div style="width: 10%; font-size: 12px;"><%= coupon.isActive==true &&coupon.expireOn > new Date()?'Available':'Expired' %></div>
                                              <div style="width: 10%; text-align: center;">
                                                <a href="#" 
                                                   class="delete-coupon" 
                                                   data-id="<%= coupon._id %>" 
                                                   style="color: #fa3d3d; text-decoration: none; font-size: 14px;">
                                                    <i class="bi bi-trash" style="margin-right: 5px;"></i> DELETE
                                                </a>
                                            </div>
                                            
                                          </li>
                                          <% }) %>
                                      </ul>
                                  </div>
                                  
                               
                                  <script>
                                    document.addEventListener('DOMContentLoaded', () => {
                                        document.querySelectorAll('.delete-coupon').forEach(button => {
                                            button.addEventListener('click', async (event) => {
                                                event.preventDefault();
                                
                                                const couponId = button.getAttribute('data-id');
                                
                                                const result = await Swal.fire({
                                                    title: 'Are you sure?',
                                                    text: "You won't be able to revert this!",
                                                    icon: 'warning',
                                                    showCancelButton: true,
                                                    confirmButtonColor: '#3085d6',
                                                    cancelButtonColor: '#d33',
                                                    confirmButtonText: 'Yes, delete it!'
                                                });
                                
                                                if (result.isConfirmed) {
                                                    try {
                                                        const response = await fetch(`/admin/coupons-list/${couponId}`, {
                                                            method: 'DELETE',
                                                        });
                                
                                                        if (response.ok) {
                                                            Swal.fire(
                                                                'Deleted!',
                                                                'Your coupon has been deleted.',
                                                                'success'
                                                            );
                                
                                                            button.closest('li').remove();
                                                        } else {
                                                            const errorData = await response.json();
                                                            Swal.fire('Error', errorData.message, 'error');
                                                        }
                                                    } catch (error) {
                                                        console.error('Error deleting coupon:', error);
                                                        Swal.fire('Error', 'An error occurred while deleting the coupon.', 'error');
                                                    }
                                                }
                                            });
                                        });
                                    });
                                </script>
                                
                                    <div class="divider"></div>
                                    <div class="flex items-center justify-between flex-wrap gap10">
                                      <div class="text-tiny">Showing <%= limit %> entries</div>
                                      <ul class="wg-pagination">
                                          <!-- Previous page button -->
                                          <% if (page> 1) { %>
                                              <li>
                                                  <a href="?page=<%= page - 1 %>&limit=<%= limit %>"><i
                                                          class="icon-chevron-left"></i></a>
                                              </li>
                                              <% } %>

                                                  <!-- Page numbers -->
                                                  <% for (let i=1; i <=totalPages; i++) { %>
                                                      <li class="<%= page === i ? 'active' : '' %>">
                                                          <a href="?page=<%= i %>&limit=<%= limit %>">
                                                              <%= i %>
                                                          </a>
                                                      </li>
                                                      <% } %>

                                                          <!-- Next page button -->
                                                          <% if (page < totalPages) { %>
                                                              <li>
                                                                  <a href="?page=<%= page + 1 %>&limit=<%= limit %>"><i
                                                                          class="icon-chevron-right"></i></a>
                                                              </li>
                                                              <% } %>
                                        </ul>   
                                        </div>
                                </div>
                               
                            </div>
                          
                        </div>
                    
                    </div>
                   
                </div>
                
            </div>
           
        </div>
       
    </div>
    <!-- /#wrapper -->

    <!-- Javascript -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="/js/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/bootstrap-select.min.js"></script>
    <script src="/js/zoom.js"></script>
    <!-- <script src="js/switcher.js"></script> -->
    <script src="/js/theme-settings.js"></script>
    <script src="/js/main.js"></script>

</body>

</html>